{% extends "dashboard_base.html" %}

{% block sidebar %}
<div class="sidebar-section-title">ADMIN CONTROL</div>

<a href="/admin/dashboard" class="nav-item">
	<span class="nav-icon">◻</span>
	<span>Dashboard</span>
</a>
<a href="/admin/users" class="nav-item">
	<span class="nav-icon">⌘</span>
	<span>Users</span>
</a>
<a href="/admin/events" class="nav-item">
	<span class="nav-icon">◷</span>
	<span>Events</span>
</a>
<a href="/admin/allocations" class="nav-item">
	<span class="nav-icon">⇄</span>
	<span>Allocations</span>
</a>
<a href="/admin/complaints" class="nav-item active">
	<span class="nav-icon">!</span>
	<span>Complaints</span>
</a>
<a href="/admin/analytics" class="nav-item">
	<span class="nav-icon">▦</span>
	<span>Analytics</span>
</a>

<div class="sidebar-divider"></div>

<a href="/logout" class="nav-item logout-item">
	<span class="nav-icon">↩</span>
	<span>Logout</span>
</a>
{% endblock %}

{% block page_title %}Complaints Management{% endblock %}

{% block content %}
<div class="stats-grid admin-kpi-grid">
	<div class="stat-card admin-kpi">
		<h4>Total Complaints</h4>
		<p>{{ complaint_insights.total }}</p>
	</div>
	<div class="stat-card admin-kpi">
		<h4>Under Review</h4>
		<p>{{ complaint_insights.under_review }}</p>
	</div>
	<div class="stat-card admin-kpi">
		<h4>Escalated</h4>
		<p>{{ complaint_insights.escalated }}</p>
	</div>
	<div class="stat-card admin-kpi">
		<h4>Resolved</h4>
		<p>{{ complaint_insights.resolved }}</p>
	</div>
	<div class="stat-card admin-kpi">
		<h4>Rejected</h4>
		<p>{{ complaint_insights.rejected }}</p>
	</div>
</div>

<div class="card">
	<div class="section-header">
		<h3>Complaint Resolution Queue</h3>
		<span class="muted">Update complaint status directly from the admin moderation desk</span>
	</div>
	<table class="data-table">
		<thead>
			<tr>
				<th>ID</th>
				<th>Reported By</th>
				<th>Against</th>
				<th>Issue Type</th>
				<th>Description</th>
				<th>Status</th>
				<th class="no-sort">Update</th>
			</tr>
		</thead>
		<tbody>
			{% if complaints %}
				{% for item in complaints %}
				<tr>
					<td>#{{ item.id }}</td>
					<td>{{ item.ngo_user.full_name if item.ngo_user else '-' }}</td>
					<td>{{ item.provider_user.full_name if item.provider_user else '-' }}</td>
					<td>{{ item.issue_type }}</td>
					<td>{{ item.description }}</td>
					<td><span class="status {{ status_class(item.status) }}">{{ item.status }}</span></td>
					<td>
						<form method="POST" action="{{ url_for('admin.admin_update_complaint_status', complaint_id=item.id) }}" class="inline-form" style="display:flex; gap:8px; align-items:center;">
							<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
							<select name="status" style="min-width: 140px;">
								<option value="Under Review" {% if item.status == 'Under Review' %}selected{% endif %}>Under Review</option>
								<option value="Escalated" {% if item.status == 'Escalated' %}selected{% endif %}>Escalated</option>
								<option value="Resolved" {% if item.status == 'Resolved' %}selected{% endif %}>Resolved</option>
								<option value="Rejected" {% if item.status == 'Rejected' %}selected{% endif %}>Rejected</option>
							</select>
							<button type="submit" class="btn-link secondary" style="border:none;">Save</button>
						</form>
					</td>
				</tr>
				{% endfor %}
			{% else %}
				<tr><td colspan="7">No complaints raised yet.</td></tr>
			{% endif %}
		</tbody>
	</table>
</div>
{% endblock %}
